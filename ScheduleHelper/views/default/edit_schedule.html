{{response.files.append(URL(r=request,c='static',f='css/schedule.css'))}}
{{extend 'layout.html'}}


<body onload='fillSchedule()'>
<table onmousedown='return false;'>
	<h2>Click and drag on blocks of availability</h2>
    <tr>
        <th><b>Monday</b></th>
        <th><b>Tuesday</b></th>
        <th><b>Wednesday</b></th>
        <th><b>Thursday</b></th>
        <th><b>Friday</b></th>
        <th><b>Saturday</b></th>
        <th><b>Sunday</b></th>
    </tr>
	<!--
    <tr>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
        <td class='timecell'>12:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
        <td class='timecell'>12:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
        <td class='timecell'>1:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
        <td class='timecell'>1:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
        <td class='timecell'>2:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
        <td class='timecell'>2:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
        <td class='timecell'>3:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
        <td class='timecell'>3:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
        <td class='timecell'>4:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
        <td class='timecell'>4:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
        <td class='timecell'>5:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
        <td class='timecell'>5:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
        <td class='timecell'>6:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
        <td class='timecell'>6:30AM</td>
    </tr>
    <tr>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
        <td class='timecell'>7:00AM</td>
    </tr>
    <tr>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
        <td class='timecell'>7:30AM</td>
    </tr>
	-->
    <tr id="8:00AM">
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
        <td class='timecell'>8:00AM</td>
    </tr>
    <tr id="8:30AM">
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
        <td class='timecell'>8:30AM</td>
    </tr>
    <tr id="9:00AM">
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
        <td class='timecell'>9:00AM</td>
    </tr>
    <tr id="9:30AM">
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
        <td class='timecell'>9:30AM</td>
    </tr>
    <tr id="10:00AM">
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
        <td class='timecell'>10:00AM</td>
    </tr>
    <tr id="10:30AM">
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
        <td class='timecell'>10:30AM</td>
    </tr>
    <tr id="11:00AM">
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
        <td class='timecell'>11:00AM</td>
    </tr>
    <tr id="11:30AM">
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
        <td class='timecell'>11:30AM</td>
    </tr>
    <tr id="12:00PM">
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
        <td class='timecell'>12:00PM</td>
    </tr>
    <tr id="12:30PM">
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
        <td class='timecell'>12:30PM</td>
    </tr>    
	<tr id="1:00PM">
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
        <td class='timecell'>1:00PM</td>
    </tr>
    <tr id="1:30PM">
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
        <td class='timecell'>1:30PM</td>
    </tr>    
	<tr id="2:00PM">
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
        <td class='timecell'>2:00PM</td>
    </tr>
    <tr id="2:30PM">
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
        <td class='timecell'>2:30PM</td>
    </tr>    
	<tr id="3:00PM">
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
        <td class='timecell'>3:00PM</td>
    </tr>
    <tr id="3:30PM">
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
        <td class='timecell'>3:30PM</td>
    </tr>    
	<tr id="4:00PM">
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
        <td class='timecell'>4:00PM</td>
    </tr>
    <tr id="4:30PM">
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
        <td class='timecell'>4:30PM</td>
    </tr>    
	<tr id="5:00PM">
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
        <td class='timecell'>5:00PM</td>
    </tr>
    <tr id="5:30PM">
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
        <td class='timecell'>5:30PM</td>
    </tr>    
	<tr id="6:00PM">
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
        <td class='timecell'>6:00PM</td>
    </tr>
    <tr id="6:30PM">
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
        <td class='timecell'>6:30PM</td>
    </tr>    
	<tr id="7:00PM">
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
        <td class='timecell'>7:00PM</td>
    </tr>
    <tr id="7:30PM">
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
        <td class='timecell'>7:30PM</td>
    </tr>    
	<tr id="8:00PM">
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
        <td class='timecell'>8:00PM</td>
    </tr>
    <tr id="8:30PM">
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
        <td class='timecell'>8:30PM</td>
    </tr>    
	<tr id="9:00PM">
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
        <td class='timecell'>9:00PM</td>
    </tr>
    <tr id="9:30PM">
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
        <td class='timecell'>9:30PM</td>
    </tr>    
	<tr id="10:00PM">
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
        <td class='timecell'>10:00PM</td>
    </tr>
    <tr id="10:30PM">
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
        <td class='timecell'>10:30PM</td>
    </tr>    
	<tr id="11:00PM">
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
        <td class='timecell'>11:00PM</td>
    </tr>
    <tr id="11:30PM">
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
        <td class='timecell'>11:30PM</td>
    </tr>
</table>

<button id='submit'>Save Schedule</button>
</body>

<script>
	var schedule = [[], [], [], [], [], [], []];
	var change_to = 'unknown';
	isMouseDown = false;

    function fillSchedule() {
        for(i=0; i<schedule.length; i++) {
            var time_list = new Array();
            $.ajax({
                async: false,
                type: "GET",
                url: '{{=URL('default', 'get_schedule')}}',
                data: {num: i},
                success : function(result) {
                    var r = result.substring(1, result.length-1);
                    schedule[i] = r.split(',');
                }
            });
            var time_list = schedule[i];
            for(j=0; j<time_list.length; j++){
                if(time_list[j] == '') { break; }
                var t = parseInt(time_list[j]);
                var ampm = "AM";
                if(t > 1230) {
                    t -= 1200;
                    ampm = "PM"
                }
                if(t==1200 || t==1230) { ampm = "PM" }
                t = t.toString();
                var str;
                if(t.length==3){
                    str = [t.substring(0, 1), ':', t.substring(1, 3), ampm].join('');
                }else{
                    str = [t.substring(0, 2), ":", t.substring(2, 4), ampm].join('');
                }
                var tr = document.getElementById(str);
                var td = tr.cells[i];
                $(td).css({backgroundColor:'teal'});
            }
        }
    }
    
	$('body').mousedown(function() {
        isMouseDown = true;
    })
    .mouseup(function() {
        isMouseDown = false;
		change_to = 'unknown';
    });
	$('table tr td').mouseenter(function() {
        if(isMouseDown) {
			selectCell(this);
		}
    });
	$('table tr td').mousedown(function() {
		selectCell(this);
	});
	
	function selectCell(cell) {
		if (change_to == 'unknown') {
			if (cell.style.backgroundColor == '' || cell.style.backgroundColor == 'white') {
				change_to = 'teal';
			}
			else {
				change_to = 'white';
			}
		}
		$(cell).css({backgroundColor:change_to});
		var time = cell.innerHTML;
		ampm = time.substr(time.length - 2, 2);
		time = time.replace(':', '');
		time = parseInt(time.substr(0, time.length - 2));
		if (ampm == "PM" && time < 1200)
			time += 1200;
		if (change_to == 'teal' && schedule[cell.cellIndex].indexOf(time) == -1)
			schedule[cell.cellIndex].push(time);
		else if (change_to == 'white' && schedule[cell.cellIndex].indexOf(time) != -1){
			schedule[cell.cellIndex].splice(schedule[cell.cellIndex].indexOf(time), 1);
		}
	}
	
    $(document).ready(function() {
        $("#submit").click(function() {
            for (i = 0; i < schedule.length; i++) {
				schedule[i] = schedule[i].sort(function(a, b){return a-b});
			}
            $.ajax({
                 type: "POST",
                data: {monday:schedule[0], tuesday:schedule[1], wednesday:schedule[2], thursday:schedule[3], friday:schedule[4], saturday:schedule[5], sunday:schedule[6]},
                 url: '{{=post_url}}',
                 success: function(msg){
                 }
            });
        });
    });
</script>
